const deferIdle=(e,t=1500)=>{"requestIdleCallback"in window?requestIdleCallback(e,{timeout:3e3}):setTimeout(e,t)};!function(){const e=document.querySelector(".mobile-menu-btn"),t=document.querySelector(".nav-menu");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active"),document.body.classList.toggle("menu-open")}),document.querySelectorAll(".nav-link").forEach(n=>{n.addEventListener("click",()=>{t.classList.remove("active"),e.classList.remove("active"),document.body.classList.remove("menu-open")})}))}(),function(){const e=document.getElementById("contact-form");if(!e)return;const t=document.getElementById("nombre"),n=document.getElementById("telefono"),o=document.getElementById("email"),a=document.getElementById("mensaje"),i=e.querySelector('button[type="submit"]'),r={nombre:e=>e.trim().length>=2,telefono:e=>/^[0-9]{10}$/.test(e.replace(/\s/g,"")),email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),mensaje:e=>e.trim().length>=10};function c(e,t){const n=e.value,o=e.closest(".form-field"),a=r[t](n);return 0===n.length?o.classList.remove("valid","invalid"):a?(o.classList.remove("invalid"),o.classList.add("valid")):(o.classList.remove("valid"),o.classList.add("invalid")),l(),a}function l(){r.nombre(t.value)&&r.telefono(n.value)&&r.email(o.value)&&r.mensaje(a.value)?(i.disabled=!1,i.style.opacity="1",i.style.cursor="pointer"):(i.disabled=!0,i.style.opacity="0.6",i.style.cursor="not-allowed")}t.addEventListener("input",()=>c(t,"nombre")),t.addEventListener("blur",()=>c(t,"nombre")),n.addEventListener("input",()=>{n.value=n.value.replace(/\D/g,""),c(n,"telefono")}),n.addEventListener("blur",()=>c(n,"telefono")),o.addEventListener("input",()=>c(o,"email")),o.addEventListener("blur",()=>c(o,"email")),a.addEventListener("input",()=>c(a,"mensaje")),a.addEventListener("blur",()=>c(a,"mensaje")),l()}(),function(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",async function(e){e.preventDefault();const t=new FormData(this),n=t.get("nombre"),o=t.get("telefono"),a=t.get("email"),i=t.get("mensaje"),r={timestamp:(new Date).toISOString(),nombre:n,telefono:o,email:a,mensaje:i,source:"homepage_form",url:window.location.href};window.dataLayer&&window.dataLayer.push({event:"generate_lead",form_name:"contact_form_homepage",method:"netlify_forms",value:1,currency:"MXN"});try{const e=JSON.parse(localStorage.getItem("electricista_leads")||"[]");e.push(r),localStorage.setItem("electricista_leads",JSON.stringify(e))}catch(e){}try{if(!(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t).toString()})).ok)throw new Error("Failed");{const e=`Hola! Solicito cotización:\n\nNombre: ${n}\nTel: ${o}\nEmail: ${a}\nMensaje: ${i}`;window.open(`https://wa.me/526673922273?text=${encodeURIComponent(e)}`,"_blank"),window.location.href="/gracias"}}catch(e){alert("Formulario enviado. Te redirigiremos a WhatsApp.");const t=`Hola! Solicito cotización:\n\nNombre: ${n}\nTel: ${o}\nEmail: ${a}\nMensaje: ${i}`;window.location.href=`https://wa.me/526673922273?text=${encodeURIComponent(t)}`}})}(),deferIdle(()=>{document.querySelectorAll('a[href^="https://wa.me"]').forEach(e=>{e.addEventListener("click",function(){window.dataLayer&&window.dataLayer.push({event:"whatsapp_click",location:this.closest("section")?.id||"unknown",page_location:window.location.pathname})})}),document.querySelectorAll('a[href^="tel:"]').forEach(e=>{e.addEventListener("click",function(){window.dataLayer&&window.dataLayer.push({event:"phone_click",location:this.closest("section")?.id||"unknown",page_location:window.location.pathname})})});const e=[25,50,75,90],t={};window.addEventListener("scroll",function(){const n=Math.round(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100);e.forEach(function(e){n>=e&&!t[e]&&(t[e]=!0,window.dataLayer&&window.dataLayer.push({event:"scroll_depth",scroll_percentage:e,page_location:window.location.pathname}))})}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t)return;e.preventDefault();const n=document.querySelector(t);n&&window.scrollTo({top:n.offsetTop-80,behavior:"smooth"})})});const n=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("fade-in"),n.unobserve(e.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".card, .section").forEach(e=>n.observe(e)),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"page_view",page_title:document.title,page_location:window.location.href,page_path:window.location.pathname})}),deferIdle(()=>{const e=document.getElementById("exit-intent-popup");if(!e)return;let t=!1;const n="exitPopupShown";if(sessionStorage.getItem(n))return;function o(){t||(t=!0,sessionStorage.setItem(n,"true"),e.style.display="flex",document.body.style.overflow="hidden",window.dataLayer&&window.dataLayer.push({event:"exit_intent_shown",trigger:i()?"mobile_timer":"desktop_mouseleave"}))}function a(){e.style.display="none",document.body.style.overflow=""}function i(){return window.innerWidth<=768||"ontouchstart"in window}const r=e.querySelector(".exit-popup-close");r&&r.addEventListener("click",a),e.addEventListener("click",function(t){t.target===e&&a()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&a()}),i()||document.addEventListener("mouseleave",function(e){e.clientY<10&&o()}),i()&&(setTimeout(o,3e4),history.pushState(null,"",location.href),window.addEventListener("popstate",function(){t||(o(),history.pushState(null,"",location.href))}))},2500);