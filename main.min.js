!function(){const e=document.querySelector(".mobile-menu-btn"),t=document.querySelector(".nav-menu");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active"),document.body.classList.toggle("menu-open")}),document.querySelectorAll(".nav-link").forEach(n=>{n.addEventListener("click",()=>{t.classList.remove("active"),e.classList.remove("active"),document.body.classList.remove("menu-open")})}))}(),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){const t=this.getAttribute("href");if("#"===t)return;e.preventDefault();const n=document.querySelector(t);if(n){const e=n.offsetTop-80;window.scrollTo({top:e,behavior:"smooth"})}})}),function(){const e=document.getElementById("contact-form");if(!e)return;const t=document.getElementById("nombre"),n=document.getElementById("telefono"),o=document.getElementById("email"),i=document.getElementById("mensaje"),a=e.querySelector('button[type="submit"]'),c={nombre:e=>e.trim().length>=2,telefono:e=>/^[0-9]{10}$/.test(e.replace(/\s/g,"")),email:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),mensaje:e=>e.trim().length>=10};function r(e,t){const n=e.value,o=e.closest(".form-field"),i=c[t](n);return 0===n.length?o.classList.remove("valid","invalid"):i?(o.classList.remove("invalid"),o.classList.add("valid")):(o.classList.remove("valid"),o.classList.add("invalid")),s(),i}function s(){c.nombre(t.value)&&c.telefono(n.value)&&c.email(o.value)&&c.mensaje(i.value)?(a.disabled=!1,a.style.opacity="1",a.style.cursor="pointer"):(a.disabled=!0,a.style.opacity="0.6",a.style.cursor="not-allowed")}t.addEventListener("input",()=>r(t,"nombre")),t.addEventListener("blur",()=>r(t,"nombre")),n.addEventListener("input",()=>{n.value=n.value.replace(/\D/g,""),r(n,"telefono")}),n.addEventListener("blur",()=>r(n,"telefono")),o.addEventListener("input",()=>r(o,"email")),o.addEventListener("blur",()=>r(o,"email")),i.addEventListener("input",()=>r(i,"mensaje")),i.addEventListener("blur",()=>r(i,"mensaje")),s()}(),function(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",async function(e){e.preventDefault();const t=new FormData(this),n=t.get("nombre"),o=t.get("telefono"),i=t.get("email"),a=t.get("mensaje"),c={timestamp:(new Date).toISOString(),nombre:n,telefono:o,email:i,mensaje:a,source:"homepage_form",url:window.location.href};window.dataLayer&&window.dataLayer.push({event:"generate_lead",form_name:"contact_form_homepage",method:"netlify_forms",value:1,currency:"MXN"});try{const e=JSON.parse(localStorage.getItem("electricista_leads")||"[]");e.push(c),localStorage.setItem("electricista_leads",JSON.stringify(e))}catch(e){}try{if(!(await fetch("/",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams(t).toString()})).ok)throw new Error("Netlify form submission failed");{const e=`Hola! Solicito cotización de servicios eléctricos:\n\nNombre: ${n}\nTeléfono: ${o}\nEmail: ${i}\nMensaje: ${a}`,t=`https://wa.me/526673922273?text=${encodeURIComponent(e)}`;window.open(t,"_blank"),window.location.href="/gracias"}}catch(e){alert("Formulario enviado. Te redirigiremos a WhatsApp.");const t=`https://wa.me/526673922273?text=${encodeURIComponent(`Hola! Solicito cotización de servicios eléctricos:\n\nNombre: ${n}\nTeléfono: ${o}\nEmail: ${i}\nMensaje: ${a}`)}`;window.location.href=t}})}(),document.querySelectorAll('a[href^="https://wa.me"]').forEach(e=>{e.addEventListener("click",function(){window.dataLayer&&window.dataLayer.push({event:"whatsapp_click",location:this.closest("section")?.id||"unknown",page_location:window.location.pathname})})}),document.querySelectorAll('a[href^="tel:"]').forEach(e=>{e.addEventListener("click",function(){window.dataLayer&&window.dataLayer.push({event:"phone_click",location:this.closest("section")?.id||"unknown",page_location:window.location.pathname})})}),function(){const e=[25,50,75,90],t={};window.addEventListener("scroll",function(){const n=Math.round(window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100);e.forEach(function(e){n>=e&&!t[e]&&(t[e]=!0,window.dataLayer&&window.dataLayer.push({event:"scroll_depth",scroll_percentage:e,page_location:window.location.pathname}))})})}(),function(){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("fade-in"),e.unobserve(t.target))})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});document.querySelectorAll(".card, .section").forEach(t=>{e.observe(t)})}(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered:",e.scope)}).catch(e=>{console.log("SW registration failed:",e)})}),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:"page_view",page_title:document.title,page_location:window.location.href,page_path:window.location.pathname}),console.log("✅ Electricista Culiacán Pro - JavaScript loaded successfully"),function(){const e=document.getElementById("exit-intent-popup");if(!e)return;let t=!1;const n="exitPopupShown";if(sessionStorage.getItem(n))return;function o(){t||(t=!0,sessionStorage.setItem(n,"true"),e.style.display="flex",document.body.style.overflow="hidden",window.dataLayer&&window.dataLayer.push({event:"exit_intent_shown",trigger:a()?"mobile_timer":"desktop_mouseleave"}))}function i(){e.style.display="none",document.body.style.overflow=""}function a(){return window.innerWidth<=768||"ontouchstart"in window}const c=e.querySelector(".exit-popup-close");c&&c.addEventListener("click",i),e.addEventListener("click",function(t){t.target===e&&i()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&i()}),a()||document.addEventListener("mouseleave",function(e){e.clientY<10&&o()}),a()&&(setTimeout(function(){o()},3e4),history.pushState(null,"",location.href),window.addEventListener("popstate",function(){t||(o(),history.pushState(null,"",location.href))}))}();